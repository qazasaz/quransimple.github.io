<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
	</head>
	<body>
		<p>code12××</p>
		<span>height: </span><input type="text" id="height">
		<button onclick="createTable()">create</button>

		<table cellspacing="5"></table>

		<style>
			body {
				font-size: 120%;
			}
			table{
				margin-top: 50px;
			}
			td {
				border: 1px solid black;
				padding: 5px 10px;
				text-align: center;
			}
			.wait {
				font-size: 75%;
			}
			.second_span {
				color: red;
				font-size: 80%
			}
		</style>
		<script>
			//GLOBAL VARIABLES
			//================
			let table = document.querySelector("table");

			//CREATE TABLE
			//============
			function createTable() {
				//CLEAR TABLE (if it is not)
				//==========================
				table.innerHTML = "";

				//GET WIDTH & HEIGHT
				//===================
				let height = Number(document.querySelector("#height").value);
				
				//CREATE FIRST COLUMN
				//===================
				for(let i = 10; i < height + 1; i++) {
					let this_row = document.createElement("tr");
					let this_td = document.createElement("td");
					this_td.appendChild(document.createTextNode(i));
					this_row.appendChild(this_td);
					table.appendChild(this_row);
				}

				//CREATE SECOND COLUMN
				//====================
				for(let j = 0; j < height - 9 ; j++) {
					// create variables
					let this_td = document.createElement("td");
					let first_span = document.createElement("span");
					first_span.setAttribute("class", "first_span");
					let br = document.createElement("br");
					// calculate first span
					let number_single = table.children[j].children[0].innerHTML;
					while(number_single.length > 1){
						let multiplication = 1;
						for(let i = 0; i < number_single.length; i++) {
							multiplication = multiplication * Number([number_single[i]]);
						}
						number_single = multiplication.toString();
					}
					first_span.appendChild(document.createTextNode(number_single));
					this_td.appendChild(first_span);
					this_td.appendChild(br);
					table.children[j].appendChild(this_td);
					// calculate second span
					let second_span = document.createElement("span");
					second_span.setAttribute("class", "second_span");
					let number_counter = 0;
					for(let i = 0; i < j + 1; i++) {
						if(number_single == table.children[i].children[1].children[0].innerHTML) {
							number_counter = number_counter + 1;
						}
					}
					second_span.appendChild(document.createTextNode(number_counter + 1));
					this_td.appendChild(second_span);
				}

				//CREATE THIRD COLUMN (initial calculation)
				//=========================================
				for(let k = 0; k < height - 9 ; k++) {
					// calculate first span
					let this_td = document.createElement("td");
					last_td_first_span = Number(table.children[k].lastChild.children[0].innerHTML);
					last_td_second_span = Number(table.children[k].lastChild.children[2].innerHTML);
					let first_span = document.createElement("span");
					let first_number = last_td_first_span * last_td_second_span;
					first_span.appendChild(document.createTextNode(first_number));
					this_td.appendChild(first_span);
					table.children[k].appendChild(this_td);
				}

				//RECALCULATE THIRD COLUMN (if numbers have more than one digit)
				//==============================================================
				for(let m = 0; m < height - 9 ; m++) {
					// if number has more than one digit
					if(table.children[m].lastChild.children[0].innerHTML.toString().length > 1) {
						// if it depends on itself
						if(table.children[m].children[0].innerHTML == table.children[m].lastChild.children[0].innerHTML) {
							table.children[m].lastChild.children[0].innerHTML = "∞";
						}
						else {
							// if it depends on previous numbers
							if(Number(table.children[m].lastChild.children[0].innerHTML) < Number(table.children[m].children[0].innerHTML)) {
								let index = Number(table.children[m].lastChild.children[0].innerHTML);
								let  previous_num = table.children[index - 10].lastChild.children[0].innerHTML;
								table.children[m].lastChild.children[0].innerHTML = previous_num;
								if(previous_num.indexOf("wait for number") != -1) {
									let concat = "wait for number " + table.children[index - 10].children[0].innerHTML + " - ";
									table.children[m].lastChild.children[0].innerHTML = previous_num.replace("wait for number", concat);
								}
							}
							else {
								// if it depends on future numbers
								if(Number(table.children[m].lastChild.children[0].innerHTML) > Number(table.children[m].children[0].innerHTML)) {
									let number_to_wait = table.children[m].lastChild.children[0].innerHTML;
									table.children[m].lastChild.children[0].innerHTML = "wait for number " + number_to_wait;
								}
							}
						}
					}
				}

				//RECALCULATE THIRD COLUMN (if cells are waiting for a result)
				//============================================================
				for(let o = 0; o < 10 ; o++) {
					for(let l = 0; l < height - 9 ; l++) {
						let this_cell = table.children[l].lastChild.children[0].innerHTML;
						if(this_cell.indexOf("wait for number") != -1 && table.children[l].lastChild.children.length == 1) {
							let number_to_wait = "";
							this_cell = table.children[l].lastChild.children[0].innerHTML;
							if(this_cell.indexOf("-") != -1) {
								number_to_wait = this_cell.split("-")[this_cell.split("-").length - 1];
							} else {
								number_to_wait = this_cell.slice(16);
							}
							if(number_to_wait <= height) {
								let desiered_cell_value = table.children[Number(number_to_wait) - 10].lastChild.children[0].innerHTML;
								if(desiered_cell_value.indexOf("wait for number") == -1) {
									let first_span = document.createElement("span");
									first_span.setAttribute("class", "first_span");
									first_span.appendChild(document.createTextNode(desiered_cell_value));
									table.children[l].lastChild.appendChild(document.createElement("br"));
									table.children[l].lastChild.appendChild(first_span);
								} else {
									table.children[l].lastChild.style.backgroundColor = "gray";
								}
							} else {
								table.children[l].lastChild.style.backgroundColor = "gray";
							}
						}
					}
				}

				//STYLING
				//=======
				for(let n = 0; n < height - 9 ; n++) {
					let last_td = table.children[n].lastChild;
					// if the number is infinity (check first child)
					if(last_td.children[0].innerHTML.indexOf("∞") != -1) {
						table.children[n].lastChild.style.color = "white";
						table.children[n].lastChild.style.backgroundColor = "black";
					}
					// if the number is infinity (check third child)
					if(last_td.children.length > 1 && last_td.children[2].innerHTML.indexOf("∞") != -1) {
						table.children[n].lastChild.style.color = "white";
						table.children[n].lastChild.style.backgroundColor = "black";
					}
					// if this cell should wait
					if(last_td.children[0].innerHTML.indexOf("wait for number") != -1) {
						table.children[n].lastChild.children[0].setAttribute("class", "wait");
					}
				}
			}
		</script>
	</body>
</html>